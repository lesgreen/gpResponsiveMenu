// gpResponsiveMenu v0.5.2 - jQuery responsive menu plugin
// (c) 2013 Les Green - GrasshopperPebbles.com
// License: http://www.gnu.org/licenses/

(function(e){e.fn.extend({gpResponsiveMenu:function(t){opts=e.extend({},e.gpMenu.defaults,t);return this.each(function(){new e.gpMenu(this,opts)})}});e.gpMenu=function(t,n){function f(e){var t;if(e=="primary"){t=c(e,n.media_query_modes)}else{var r=n.secondary_nav;t=c(e,r.media_query_modes)}if(t.viewType){var i=e=="primary"?s:o;if(t.viewType!=i){l(e,t.viewType);C(e);if(t.viewType=="Select"){p(t)}else{g(t)}}}else{k(e)}}function l(e,t){if(e=="primary"){s=t}else{o=t}}function c(t,n){var r=e(window).width();var i={};e.each(n,function(e,n){if(n.min){if(r>=n.min&&r<=n.max){i=h(i,n,t);return false}}else{if(r<=n.max){i=h(i,n,t);return false}}});return i}function h(e,t,r){e.viewType=t.mode;e.menuType=r;var i=r=="primary"?n:n.secondary_nav;e.nav_parent=t.nav_parent?t.nav_parent:i.nav_parent;if(t.nav_toggle_parent){e.nav_toggle_parent=t.nav_toggle_parent}else if(i.nav_toggle_parent){e.nav_toggle_parent=i.nav_toggle_parent}else{e.nav_toggle_parent=e.nav_parent}if(t.nav_position){e.nav_position=t.nav_position}else if(i.nav_position){e.nav_position=i.nav_position}if(t.nav_toggle_position){e.nav_toggle_position=t.nav_toggle_position}else if(i.nav_toggle_position){e.nav_toggle_position=i.nav_toggle_position}e.menu_select_text=i.menu_select_text?i.menu_select_text:n.menu_select_text;if(i.menu_structure){e.menu_structure=i.menu_structure}if(i.nav_cntnr_class){e.nav_cntnr_class=i.nav_cntnr_class}e.active_class=i.active_class?i.active_class:n.active_class;if(i.page_wrapper){e.page_wrapper=i.page_wrapper}if(i.show_close_btn){e.show_close_btn=i.show_close_btn}e.parent_menu_prefix=i.parent_menu_prefix?i.parent_menu_prefix:n.parent_menu_prefix;if(i.nav_toggle_class){e.nav_toggle_class=i.nav_toggle_class}if(i.nav_toggle_icon_class){e.nav_toggle_icon_class=i.nav_toggle_icon_class}if(i.nav_toggle_wrapper_class){e.nav_toggle_wrapper_class=i.nav_toggle_wrapper_class}if(i.nav_toggle_text){e.nav_toggle_text=i.nav_toggle_text}e.show_nav_toggle_caret=i.show_nav_toggle_caret;e.show_nav_caret=i.show_nav_caret;return e}function p(t){L(t.menuType,false);var n=e("<select></select>").addClass("gp-responsive-select");var r=t.menuType=="primary"?"gp-select-primary":"gp-select-secondary";e(n).addClass(r);e('<option value="">'+t.menu_select_text+"</option>").appendTo(e(n));var i=N(t);if(t.menu_structure){v(n,i,t,0)}else{d(n,i,0)}var s=w(t,n);e(n).on("change",function(){if(e(this).selectedIndex!=0){if(e(this).data("target")){window.open(e(this).val(),"new_window")}if(isNaN(e(this).val())){document.location.href=e(this).val()}}})}function d(t,n,r){var i,s,o,u;e.each(n,function(n,a){i=e(a).children();e.each(i,function(n,i){o=e(i).get(0).tagName;if(o=="A"){u=e('<option value="'+e(i).attr("href")+'">'+m(r)+e(i).text()+"</option>").appendTo(e(t));if(e(i).attr("target")){e(u).data("url_target",e(i).attr("target"))}}else if(o=="UL"){s=e(i).children("li");d(t,s,r+1)}})})}function v(t,n,r,i){var s;var o=r.menu_structure;e.each(n,function(n,r){s=e(r).get(0).tagName;if(s==o.menu_caption_tag){e('<option value="'+n+'">'+m(i)+e(r).text()+"</option>").appendTo(e(t));d(t,e(r).next(o.menu_item_parent_tag).children(o.menu_item_tag),i+1)}})}function m(e){var t=" ";for(i=0;i<e;i++){t+="-"}return t+" "}function g(t){L(t.menuType,false);var n;var r=e('<div class="'+t.nav_cntnr_class+'" role="navigation">');e(r).addClass("gp-nav-"+t.menuType);var i=w(t,r);var s=N(t);if(t.menu_structure){n=b(s,t,0)}else{n=y(s,0)}e(r).append(e(n));var i=E(r,t);var i=T(t)}function y(t,n){var r,i,s,o;var u=e("<ul></ul>");e.each(t,function(t,a){r=e("<li></li>").addClass("level-"+n);if(t==0){e(r).addClass("first")}i=e(a).children();e.each(i,function(t,i){o=e(i).get(0).tagName;if(o=="A"){e(r).append(e("<a></a>").attr({href:e(i).attr("href"),title:e(i).attr("title")}).text(e(i).text()))}else if(o=="UL"){s=y(e(i).children("li"),n+1);e(r).append(e(s))}});e(r).appendTo(e(u))});return e(u)}function b(t,r,i){var s,o,u,a;var f=n.menu_structure;var l=r.viewType;var c=l=="PageOverlay"?e("<div></div"):e("<ul></ul>");e.each(t,function(t,n){o=e(n).get(0).tagName;if(o==f.menu_caption_tag){if(l=="PageOverlay")a=e("<ul></ul>").appendTo(e(c));s=e("<li></li>").addClass("level-"+i);if(t==0){e(s).addClass("first")}e(s).append(e("<a></a>").attr("href","#").text(e(n).text()));u=y(e(n).next(f.menu_item_parent_tag).children(f.menu_item_tag),i+1);e(u).appendTo(e(s))}if(l=="PageOverlay"){e(s).appendTo(e(a))}else{e(s).appendTo(e(c))}});return e(c)}function w(t,n){var r=["InlineOverlay","Select"];if(r.indexOf(t.viewType)==-1){var i=S(t);if(t.nav_toggle_position=="last"){e(t.nav_toggle_parent).append(e(i))}else{e(t.nav_toggle_parent).prepend(e(i))}}if(t.viewType=="SplitView"){if(t.page_wrapper=="body"){e("body").wrapInner('<div class="gp-responsive-page-wrapper" />');e("body").prepend(e(n))}else{e(t.page_wrapper).prepend(e(n))}if(t.show_close_btn){var s=e("<a></a>").addClass("gp-responsive-nav-close").prependTo(e("."+t.nav_cntnr_class));x(s,t)}}else{if(t.nav_position=="last"){e(t.nav_parent).append(e(n))}else{e(t.nav_parent).prepend(e(n))}}return true}function E(t,n){var r,i;var s=e(t).find("li").has("ul");e.each(e(s),function(t,s){e(this).addClass("gp-responsive-has-sub");r=e(this).children("a")[0];i=e(this).children("ul")[0];if(e(r).attr("href")=="#"){e(r).addClass("gp-category-title")}else{e(i).prepend(e("<li></li>").addClass("level-"+e(i).index()).append(e(r).clone(true).text(n.parent_menu_prefix+" "+e(r).text())));if(e(r).parent("li").hasClass("level-0")){e(r).attr("href","#").addClass("gp-category-title")}else{e(r).attr("href","#").addClass("gp-sub-category-title")}}if(n.viewType!="PageOverlay"){if(n.show_nav_caret){e(r).append('<b class="gp-nav-caret" />')}}});return true}function S(t){var n=t.viewType;var r=e("<a></a>").addClass(t.nav_toggle_class);if(t.nav_toggle_icon_class){e(r).attr("title",t.nav_toggle_text).addClass(t.nav_toggle_icon_class)}else{e(r).text(t.nav_toggle_text);if(t.show_nav_toggle_caret){e(r).append('<b class="gp-toggle-caret" />')}}x(r,t);if(t.nav_toggle_wrapper_class){return e("<div></div>").addClass(t.nav_toggle_wrapper_class+" gp-toggle-"+t.menuType).append(e(r))}else{return e(r).addClass("gp-toggle-"+t.menuType)}}function x(t,n){var r=n.viewType;e(t).click(function(t){e(this).toggleClass(n.active_class);e("."+n.nav_cntnr_class).toggle();if(r=="SplitView"){e("body").toggleClass(n.active_class)}t.preventDefault()})}function T(t){e("."+t.nav_cntnr_class+" .gp-responsive-has-sub a").click(function(n){var r=e(this).attr("href");if(r=="#"){e(this).toggleClass(t.active_class);if(t.viewType=="InlineOverlay"){var i=e(this).parents("ul").length;if(i==1){e(u).hide();e(u).find("ul").hide()}else{e(a).hide()}var s=e(this).parent().children("ul");if(i==1){if(!e(s).is(u)){e(s).show()}u=s}else{if(!e(s).is(a)){e(s).show()}a=s}}else{e(this).parent().children("ul").toggle()}n.preventDefault()}});return true}function N(t){var i;var s=n.secondary_nav;var o=t.menuType=="primary"?r:e(s.menu_container);if(t.menu_structure){var u=t.menu_structure;i=u.menu_tag=="self"?e(o).children():e(o).children(u.menu_tag).children()}else{i=e(o).children("li")}return i}function C(t){e(".gp-toggle-"+t).remove();e(".gp-nav-"+t).remove();e(".gp-select-"+t).remove()}function k(e){if(e=="primary"){s=""}else{o=""}C(e);L(e,true)}function L(t,i){var s;if(t=="primary"){s=n.nav_container_parent?n.nav_container_parent:r.children()}else{s=n.secondary_nav;s=s.menu_container}if(i){e(s).show()}else{e(s).hide()}}var r=e(t);var s="";var o="";var u="";var a="";e(window).resize(function(){f("primary");if(n.secondary_nav){f("secondary")}});f("primary");if(n.secondary_nav){f("secondary")}};e.gpMenu.defaults={nav_container_parent:"",menu_select_text:"MENU",nav_toggle_text:"MENU",nav_toggle_icon_class:"",nav_toggle_class:"gp-responsive-nav-toggle",nav_toggle_parent:"",nav_toggle_wrapper_class:"gp-responsive-toggle-wrapper",nav_toggle_position:"last",show_nav_toggle_caret:true,show_nav_caret:true,nav_parent:"",nav_position:"last",nav_cntnr_class:"gp-responsive-nav-cntnr",media_query_modes:"",menu_structure:"",page_wrapper:".wrapper",parent_menu_prefix:"All ",active_class:"active",show_close_btn:false,secondary_nav:""}})(jQuery)